From f60bd8f6698adb9204dd6b49351eaa10a930c679 Mon Sep 17 00:00:00 2001
From: Michael Donahoe <michael.donahoe@systematicgroup.com>
Date: Fri, 12 Jul 2019 17:21:55 +0000
Subject: [PATCH 1/4] Modify cmake to use pkgconfig

---
 CMakeLists.txt | 13 ++++++-------
 1 file changed, 6 insertions(+), 7 deletions(-)

diff --git a/CMakeLists.txt b/CMakeLists.txt
index 9c81a69..ed3c841 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -3,7 +3,7 @@ cmake_minimum_required(VERSION 3.3)
 project(Widevine)
 
 find_package(WPEFramework)
-
+find_package(PkgConfig REQUIRED)
 list(APPEND CMAKE_MODULE_PATH "${CMAKE_CURRENT_SOURCE_DIR}/cmake")
 
 set(PLUGIN_NAME Widevine)
@@ -11,9 +11,8 @@ set(MODULE_NAME WPEFramework${PLUGIN_NAME})
 
 # This contains all kinds of plugins (publicely available, so they all need the plugin support library !!
 
-find_package(${NAMESPACE}Core REQUIRED)
-find_package(WideVine REQUIRED)
-
+pkg_check_modules (WIDEVINE widevine)
+pkg_check_modules (WPEFRAMEWORK WPEFrameworkCore)
 set(PLUGIN_SOURCES
     HostImplementation.cpp
     DeviceCertificate.cpp
@@ -23,9 +22,9 @@ set(PLUGIN_SOURCES
 # add the library
 add_library(${PLUGIN_NAME} SHARED ${PLUGIN_SOURCES})
 target_compile_definitions(${PLUGIN_NAME} PRIVATE ${WIDEVINE_FLAGS})
-target_include_directories(${PLUGIN_NAME} PRIVATE ${PLUGINS_INCLUDE_DIR} ${WIDEVINE_INCLUDE_DIRS})
-target_link_libraries(${PLUGIN_NAME} PRIVATE ${PLUGIN_LIBS} ${NAMESPACE}Core::${NAMESPACE}Core ${WIDEVINE_LIBRARIES})
+target_include_directories(${PLUGIN_NAME} PRIVATE ${WPEFRAMEWORK_INCLUDE_DIRS} ${PLUGINS_INCLUDE_DIR} ${WIDEVINE_INCLUDE_DIRS})
+target_link_libraries(${PLUGIN_NAME} PRIVATE ${PLUGIN_LIBS} ${WIDEVINE_LIBRARIES})
 set_target_properties(${PLUGIN_NAME} PROPERTIES SUFFIX ".drm")
 set_target_properties(${PLUGIN_NAME} PROPERTIES PREFIX "")
 
-install(TARGETS ${PLUGIN_NAME} DESTINATION ${CMAKE_INSTALL_PREFIX}/share/${NAMESPACE}/OCDM)
\ No newline at end of file
+install(TARGETS ${PLUGIN_NAME} DESTINATION ${CMAKE_INSTALL_PREFIX}/share/${NAMESPACE}/OCDM)
-- 
2.7.4

